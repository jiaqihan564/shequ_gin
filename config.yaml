# 社区后端配置文件
# 配置文件优先级：环境变量 > 配置文件 > 默认值

# 服务器配置
server:
  host: "localhost"
  port: "3001"
  mode: "release"  # debug, release, test

# 数据库配置
database:
  host: "127.0.0.1"
  port: "3306"
  username: "root"
  password: "root"
  database: "hub"
  charset: "utf8mb4"
  max_open_conns: 150      # 优化: 从100增加到150，提升并发能力
  max_idle_conns: 50       # 优化: 从25增加到50，减少连接创建开销
  conn_max_lifetime: "30m" # 优化: 从1h调整为30m，更快释放长时间空闲连接
  conn_max_idle_time: "5m" # 空闲连接最大存活时间

# JWT配置
jwt:
  secret_key: "your_secret_key_change_this_in_production"
  expire_hours: 24
  issuer: "community-api"

# 日志配置
log:
  level: "debug"  # debug, info, warn, error
  format: "json"  # json, text
  output: "file"  # stdout, file
  file_path: "log/app.log"
  max_size: 100  # MB
  max_backups: 3
  max_age: 28  # days
  async: true
  buffer: 1024
  drop_policy: "block"  # block | drop_new | drop_oldest

# 安全配置
security:
  max_login_attempts: 5

# 管理员配置
admin:
  # 管理员用户名列表（精确匹配）
  usernames:
    - "admin"
  default_password: "admin123"

# CORS配置
cors:
  allow_origins: ["*"]
  allow_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allow_headers: ["Origin", "Content-Type", "Content-Length", "Accept-Encoding", "X-CSRF-Token", "Authorization"]
  allow_credentials: true

# 静态资源/对象存储配置（用于头像等）
assets:
  # 指向桶根目录的可访问 URL（不要带尾部斜杠）
  # 例如针对 MinIO： http://127.0.0.1:9000/community-assets
  public_base_url: "http://127.0.0.1:9000/community-assets"
  max_avatar_size_mb: 5
  # 历史头像最大保留数量（含归档，不含当前 avatar.png）
  max_avatar_history: 9

# MinIO 对象存储配置
minio:
  endpoint: "127.0.0.1:9000"
  access_key_id: "minioadmin"
  secret_access_key: "minioadmin"
  use_ssl: false
  bucket: "community-assets"

# 资源存储配置（独立桶）
resources_storage:
  bucket: "community-resources"
  public_base_url: "http://127.0.0.1:9000/community-resources"

# 代码执行器配置
code_executor:
  piston_api_url: "https://emkc.org/api/v2/piston"
  timeout: 10  # 执行超时时间（秒）
  max_memory_mb: 128  # 最大内存限制（MB）
  rate_limit: 10  # 每分钟执行次数限制